server {
	listen 80 default_server;
	server_name _;

{% if inventory_hostname in groups['web_servers'] %}
  location / {
    uwsgi_pass localhost:5000;
    include uwsgi_params;
  }
{% endif %}

  location /node-metrics {
    proxy_pass http://localhost:{{ prometheus_exporters['node']['port'] }}/metrics;
  }

{% if inventory_hostname in groups['dns_servers'] %}
  location /prometheus {
    proxy_pass http://localhost:{{ prometheus_port }};
  }
{% endif %}

}
